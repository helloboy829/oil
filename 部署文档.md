# æœºæ²¹é”€å”®ç®¡ç†ç³»ç»Ÿ - éƒ¨ç½²æ–‡æ¡£

## ç›®å½•ç»“æ„

```
oil/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ Dockerfile             # åç«¯ Docker é•œåƒ
â”‚   â””â”€â”€ target/
â”‚       â””â”€â”€ oil-system-1.0.0.jar
â”œâ”€â”€ frontend/                   # å‰ç«¯ä»£ç 
â”‚   â””â”€â”€ dist/                  # æ„å»ºäº§ç‰©
â”œâ”€â”€ deploy/                     # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ init.sql               # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”œâ”€â”€ nginx.conf             # Nginx é…ç½®
â”‚   â”œâ”€â”€ install-server.sh      # æœåŠ¡å™¨ç¯å¢ƒå®‰è£…
â”‚   â”œâ”€â”€ deploy-backend.sh      # åç«¯éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ deploy-frontend.sh     # å‰ç«¯éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ build-local.bat        # Windows æœ¬åœ°æ„å»º
â””â”€â”€ docker-compose.yml          # Docker éƒ¨ç½²é…ç½®
```

---

## æ–¹æ¡ˆä¸€ï¼šDocker éƒ¨ç½²ï¼ˆæ¨èï¼‰â­â­â­â­â­

### ä¼˜ç‚¹
- ä¸€é”®éƒ¨ç½²ï¼Œç®€å•å¿«é€Ÿ
- ç¯å¢ƒéš”ç¦»ï¼Œé¿å…å†²çª
- æ˜“äºè¿ç§»å’Œæ‰©å±•

### å‰ç½®è¦æ±‚
- æœåŠ¡å™¨å·²å®‰è£… Docker å’Œ Docker Compose
- è‡³å°‘ 1æ ¸2G å†…å­˜

### éƒ¨ç½²æ­¥éª¤

#### 1. å®‰è£… Dockerï¼ˆUbuntu/Debianï¼‰
```bash
# å®‰è£… Docker
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER

# å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# éªŒè¯å®‰è£…
docker --version
docker-compose --version
```

#### 2. æœ¬åœ°æ„å»ºé¡¹ç›®
åœ¨ Windows æœ¬åœ°è¿è¡Œï¼š
```cmd
cd d:\code\oil
deploy\build-local.bat
```

#### 3. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
ä¸Šä¼ æ•´ä¸ªé¡¹ç›®ç›®å½•åˆ°æœåŠ¡å™¨ï¼š
```bash
# åœ¨æœ¬åœ°ï¼ˆä½¿ç”¨ SCP æˆ– FTP å·¥å…·ï¼‰
scp -r d:\code\oil root@your-server-ip:/opt/
```

#### 4. å¯åŠ¨æœåŠ¡
```bash
cd /opt/oil
docker-compose up -d
```

#### 5. æŸ¥çœ‹çŠ¶æ€
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend

# æŸ¥çœ‹ MySQL æ—¥å¿—
docker-compose logs -f mysql
```

#### 6. è®¿é—®ç³»ç»Ÿ
- ç®¡ç†åå°: `http://your-server-ip/`
- H5 æ‰«ç é¡µé¢: `http://your-server-ip/scan`

### å¸¸ç”¨å‘½ä»¤
```bash
# åœæ­¢æœåŠ¡
docker-compose stop

# å¯åŠ¨æœåŠ¡
docker-compose start

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f [service-name]

# è¿›å…¥å®¹å™¨
docker exec -it oil-backend sh
```

---

## æ–¹æ¡ˆäºŒï¼šä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

### ä¼˜ç‚¹
- æ›´çµæ´»çš„é…ç½®
- æ€§èƒ½æ›´å¥½ï¼ˆæ— å®¹å™¨å¼€é”€ï¼‰

### å‰ç½®è¦æ±‚
- Ubuntu 20.04 æˆ– CentOS 7+
- è‡³å°‘ 1æ ¸2G å†…å­˜

### éƒ¨ç½²æ­¥éª¤

#### 1. æœ¬åœ°æ„å»ºé¡¹ç›®
åœ¨ Windows æœ¬åœ°è¿è¡Œï¼š
```cmd
cd d:\code\oil
deploy\build-local.bat
```

#### 2. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
```bash
# ä¸Šä¼ åç«¯ JAR
scp backend\target\oil-system-1.0.0.jar root@your-server-ip:/root/

# ä¸Šä¼ å‰ç«¯æ„å»ºäº§ç‰©
scp -r frontend\dist root@your-server-ip:/root/

# ä¸Šä¼ éƒ¨ç½²è„šæœ¬
scp -r deploy root@your-server-ip:/root/
```

#### 3. å®‰è£…æœåŠ¡å™¨ç¯å¢ƒ
```bash
# SSH ç™»å½•åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# è¿è¡Œç¯å¢ƒå®‰è£…è„šæœ¬
cd /root/deploy
chmod +x *.sh
sudo ./install-server.sh
```

#### 4. åˆå§‹åŒ–æ•°æ®åº“
```bash
# å¯¼å…¥æ•°æ®åº“
mysql -u root -p < /root/deploy/init.sql
```

#### 5. éƒ¨ç½²åç«¯
```bash
cd /root
chmod +x deploy/deploy-backend.sh
sudo ./deploy/deploy-backend.sh
```

#### 6. éƒ¨ç½²å‰ç«¯
```bash
cd /root
chmod +x deploy/deploy-frontend.sh
sudo ./deploy/deploy-frontend.sh
```

#### 7. è®¿é—®ç³»ç»Ÿ
- ç®¡ç†åå°: `http://your-server-ip/`
- H5 æ‰«ç é¡µé¢: `http://your-server-ip/scan`

### å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹åç«¯æœåŠ¡çŠ¶æ€
systemctl status oil-system

# æŸ¥çœ‹åç«¯æ—¥å¿—
journalctl -u oil-system -f

# é‡å¯åç«¯
systemctl restart oil-system

# æŸ¥çœ‹ Nginx çŠ¶æ€
systemctl status nginx

# é‡å¯ Nginx
systemctl restart nginx

# æŸ¥çœ‹ Nginx æ—¥å¿—
tail -f /var/log/nginx/error.log
```

---

## é…ç½®ä¿®æ”¹

### 1. ä¿®æ”¹åç«¯é…ç½®
ç¼–è¾‘ `backend/src/main/resources/application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/oil_system?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: oil
    password: your_password  # ä¿®æ”¹ä¸ºå®é™…å¯†ç 

qrcode:
  save-path: /opt/oil-system/qrcodes/  # ä¿®æ”¹ä¸ºå®é™…è·¯å¾„
```

### 2. ä¿®æ”¹ Nginx åŸŸå
ç¼–è¾‘ `deploy/nginx.conf`:

```nginx
server {
    listen 80;
    server_name your-domain.com;  # ä¿®æ”¹ä¸ºä½ çš„åŸŸå
    ...
}
```

### 3. ä¿®æ”¹ Docker ç¯å¢ƒå˜é‡
ç¼–è¾‘ `docker-compose.yml`:

```yaml
environment:
  MYSQL_ROOT_PASSWORD: your_root_password  # ä¿®æ”¹å¯†ç 
  MYSQL_PASSWORD: your_password           # ä¿®æ”¹å¯†ç 
```

---

## SSL/HTTPS é…ç½®ï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦

#### 1. å®‰è£… Certbot
```bash
sudo apt install certbot python3-certbot-nginx -y
```

#### 2. è·å–è¯ä¹¦
```bash
sudo certbot --nginx -d your-domain.com
```

#### 3. è‡ªåŠ¨ç»­æœŸ
```bash
sudo certbot renew --dry-run
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. JVM å‚æ•°è°ƒä¼˜
ç¼–è¾‘åç«¯å¯åŠ¨å‚æ•°ï¼š

```bash
# å¯¹äº 1æ ¸2G æœåŠ¡å™¨
java -Xms256m -Xmx512m -jar app.jar

# å¯¹äº 2æ ¸4G æœåŠ¡å™¨
java -Xms512m -Xmx1024m -jar app.jar
```

### 2. MySQL ä¼˜åŒ–
ç¼–è¾‘ `/etc/mysql/mysql.conf.d/mysqld.cnf`:

```ini
[mysqld]
max_connections = 100
innodb_buffer_pool_size = 256M  # è®¾ç½®ä¸ºå†…å­˜çš„ 50-70%
query_cache_size = 32M
```

### 3. Nginx ä¼˜åŒ–
ç¼–è¾‘ `/etc/nginx/nginx.conf`:

```nginx
worker_processes auto;
worker_connections 1024;

gzip on;
gzip_comp_level 6;
```

---

## ç›‘æ§å’Œæ—¥å¿—

### 1. æŸ¥çœ‹ç³»ç»Ÿèµ„æº
```bash
# CPU å’Œå†…å­˜ä½¿ç”¨
htop

# ç£ç›˜ä½¿ç”¨
df -h

# ç½‘ç»œè¿æ¥
netstat -tulpn
```

### 2. åº”ç”¨æ—¥å¿—ä½ç½®
- åç«¯æ—¥å¿—: `journalctl -u oil-system -f`
- Nginx è®¿é—®æ—¥å¿—: `/var/log/nginx/access.log`
- Nginx é”™è¯¯æ—¥å¿—: `/var/log/nginx/error.log`
- MySQL æ—¥å¿—: `/var/log/mysql/error.log`

---

## å¤‡ä»½æ–¹æ¡ˆ

### 1. æ•°æ®åº“å¤‡ä»½
```bash
# æ‰‹åŠ¨å¤‡ä»½
mysqldump -u oil -p oil_system > backup_$(date +%Y%m%d).sql

# å®šæ—¶å¤‡ä»½ï¼ˆæ¯å¤©å‡Œæ™¨ 2 ç‚¹ï¼‰
crontab -e
# æ·»åŠ ï¼š
0 2 * * * mysqldump -u oil -p'your_password' oil_system > /backup/oil_$(date +\%Y\%m\%d).sql
```

### 2. æ–‡ä»¶å¤‡ä»½
```bash
# å¤‡ä»½äºŒç»´ç å’Œä¸Šä¼ æ–‡ä»¶
tar -czf backup_files_$(date +%Y%m%d).tar.gz /opt/oil-system/qrcodes/
```

---

## æ•…éšœæ’æŸ¥

### 1. åç«¯æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
journalctl -u oil-system -n 100

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep 8080

# æ£€æŸ¥ MySQL è¿æ¥
mysql -u oil -p -h localhost oil_system
```

### 2. å‰ç«¯æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
systemctl status nginx

# æµ‹è¯• Nginx é…ç½®
nginx -t

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

### 3. API è¯·æ±‚å¤±è´¥
```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:8080/api/health

# æ£€æŸ¥ Nginx ä»£ç†
curl http://localhost/api/health
```

---

## å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **: ä¿®æ”¹ MySQL root å¯†ç å’Œåº”ç”¨å¯†ç 
2. **é…ç½®é˜²ç«å¢™**: åªå¼€æ”¾ 80ã€443ã€22 ç«¯å£
3. **ä½¿ç”¨ HTTPS**: é…ç½® SSL è¯ä¹¦
4. **å®šæœŸæ›´æ–°**: ä¿æŒç³»ç»Ÿå’Œè½¯ä»¶åŒ…æ›´æ–°
5. **å¤‡ä»½æ•°æ®**: å®šæœŸå¤‡ä»½æ•°æ®åº“å’Œæ–‡ä»¶

```bash
# é…ç½®é˜²ç«å¢™ï¼ˆUFWï¼‰
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable
```

---

## æˆæœ¬ä¼°ç®—

### é˜¿é‡Œäº‘/è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨
- **é…ç½®**: 1æ ¸2Gï¼Œ60GB SSD
- **å¸¦å®½**: 3-5 Mbps
- **ä»·æ ¼**: æ–°ç”¨æˆ·é¦–å¹´ **60-80å…ƒ**
- **ç»­è´¹**: çº¦ **300-400å…ƒ/å¹´**

### åŸŸåè´¹ç”¨
- `.com` åŸŸå: é¦–å¹´ **60å…ƒ**ï¼Œç»­è´¹ **80å…ƒ/å¹´**
- `.cn` åŸŸå: é¦–å¹´ **29å…ƒ**ï¼Œç»­è´¹ **60å…ƒ/å¹´**

### æ€»è´¹ç”¨
- é¦–å¹´: **çº¦ 100-150å…ƒ**ï¼ˆå«æœåŠ¡å™¨+åŸŸåï¼‰
- ç»­è´¹: **çº¦ 400-500å…ƒ/å¹´**

---

## æŠ€æœ¯æ”¯æŒ

### é»˜è®¤è´¦æˆ·ä¿¡æ¯
- **ç®¡ç†å‘˜è´¦å·**: admin
- **ç®¡ç†å‘˜å¯†ç **: admin123
- **æ•°æ®åº“ç”¨æˆ·**: oil
- **æ•°æ®åº“å¯†ç **: oil_password_2024ï¼ˆå»ºè®®ä¿®æ”¹ï¼‰

### é¡¹ç›®ä¿¡æ¯
- åç«¯æ¡†æ¶: Spring Boot 2.7.18
- å‰ç«¯æ¡†æ¶: Vue 3.3.4
- æ•°æ®åº“: MySQL 8.0
- è¿è¡Œç¯å¢ƒ: Java 11

---

## æ›´æ–°éƒ¨ç½²

### æ›´æ–°åç«¯
```bash
# åœæ­¢æœåŠ¡
systemctl stop oil-system

# å¤‡ä»½æ—§ç‰ˆæœ¬
cp /opt/oil-system/backend/oil-system-1.0.0.jar /opt/oil-system/backend/oil-system-1.0.0.jar.bak

# ä¸Šä¼ æ–°ç‰ˆæœ¬
# ...

# å¯åŠ¨æœåŠ¡
systemctl start oil-system
```

### æ›´æ–°å‰ç«¯
```bash
# å¤‡ä»½æ—§ç‰ˆæœ¬
cp -r /var/www/oil-frontend /var/www/oil-frontend.bak

# åˆ é™¤æ—§æ–‡ä»¶
rm -rf /var/www/oil-frontend/*

# ä¸Šä¼ æ–°ç‰ˆæœ¬
# ...

# é‡å¯ Nginx
systemctl reload nginx
```

---

## é™„å½•

### A. æœåŠ¡å™¨æ¨èé…ç½®

| ç”¨æˆ·æ•° | CPU | å†…å­˜ | ç¡¬ç›˜ | å¸¦å®½ | ä»·æ ¼ |
|-------|-----|------|------|------|------|
| < 50  | 1æ ¸ | 2G   | 40G  | 3M   | 60å…ƒ/å¹´ |
| 50-200| 2æ ¸ | 4G   | 60G  | 5M   | 300å…ƒ/å¹´ |
| 200+  | 4æ ¸ | 8G   | 100G | 10M  | 800å…ƒ/å¹´ |

### B. äº‘æœåŠ¡å•†æ¨è
1. **é˜¿é‡Œäº‘**: https://www.aliyun.com/product/swas
2. **è…¾è®¯äº‘**: https://cloud.tencent.com/product/lighthouse
3. **åä¸ºäº‘**: https://www.huaweicloud.com/product/ecs.html

---

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
